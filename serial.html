<!DOCTYPE html>
<html lang="pt-br">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" href="favicon.png" sizes="any" type="image/x-icon">
	<link rel="stylesheet" href="serial.css">
	<link rel="stylesheet" href="bootstrap.min.css" media="print" onload="this.media='all'">
	<link rel="stylesheet" href="all.min.css" media="all" onload="this.media='all'">
	<link rel="stylesheet" href="util.css">
	<link rel="stylesheet" href="side-bar.css">
	<link rel="stylesheet" href="top-bar.css">
	<title>WS2C - Serial Port Settings</title>
</head>

<header>
	<div id="top-bar"></div>
	<div id="side-bar"></div>
</header>

<body> 

	<div id="loading" class="hidden loading_screen">
		<h1 data-I18N="restarting">Restarting...</h1>
	</div>
	
	<div class="div-main">
	
		<div class="alert alert-warning hidden" id="div-error" role="alert">
			<p id="invalid_port" data-I18N="invalid_port" class="hidden"></p>
			<p id="same_port" data-I18N="same_port" class="hidden"></p>
			<p id="well_known_port" data-I18N="well_known_port" class="hidden"></p>
		</div>
		
		<div class="alert alert-success hidden" id="div-success" role="alert">
			<p id="success-serial" data-I18N="success_msg">
				The data has been stored successfully. </br>
				The board needs to restart for the configurations to take place. </br>
				You can click <a onclick="loading_screen()" href="/restart">HERE</a> 
				to restart now or restart manually later.
			</p>
		</div>
	
		<div class="page-title">
			<h5 data-I18N="serial_l"> Serial Port Settings </h3>
		</div>
	
		<form method="POST" id="form-post">
		
			<nav>
				<div class="nav nav-tabs" id="nav-tab" role="tablist">
					<button class="nav-link active" id="serial1-tab" data-bs-toggle="tab" data-bs-target="#nav-serial1" type="button" role="tab" aria-controls="nav-serial1" aria-selected="true">Serial 1</button>
					<button class="nav-link" id="serial2-tab" data-bs-toggle="tab" data-bs-target="#nav-serial2" type="button" role="tab" aria-controls="nav-serial2" aria-selected="false">Serial 2</button>
				</div>
			</nav>
			<div class="tab-content tab-content-serial" id="nav-tabContent">
				<div class="tab-pane fade show active" id="nav-serial1" role="tabpanel" aria-labelledby="serial1-tab">
					<!-- SERIAL 1 -->
					<div class="card card-serial">
						<div class="card-header">
							<h4 data-I18N="basic">Basic Settings</h4>
						</div>
						<div class="card-body">
							<div class="card-input">
								<span class="input-span" data-I18N="baud">Baud Rate</span>
								<select class="form-control" id="options-serial1-baudrate" name="serial1-baudrate">
									<option value="1200">1200</option>
									<option value="2400">2400</option>
									<option value="4800">4800</option>
									<option value="9600">9600</option>
									<option value="19200">19200</option>
									<option value="38400">38400</option>
									<option value="57600">57600</option>
									<option value="115200" selected>115200</option>
									<option value="250000">250000</option>
									<option value="921600">921600</option>
								</select>
							</div>
							<div class="card-input">
								<span class="input-span" data-I18N="databit">Data Bit</span>
								<select class="form-control" id="options-serial1-databit" name="serial1-databit">
									<option value="5">5</option>
									<option value="6">6</option>
									<option value="7">7</option>
									<option value="8" selected>8</option>
								</select>
							</div>
							<div class="card-input">
								<span class="input-span" data-I18N="stopbit">Stop Bit</span>
								<select class="form-control" id="options-serial1-stopbit" name="serial1-stopbit">
									<option value="1" selected>1</option>
									<option value="2">2</option>
								</select>
							</div>
							<div class="card-input">
								<span class="input-span" data-I18N="parity">Parity</span>
								<select class="form-control" id="options-serial1-parity" name="serial1-parity">
									<option value="1" selected data-I18N="none">None</option>
									<option value="2" data-I18N="even">Even</option>
									<option value="3" data-I18N="odd">Odd</option>
								</select>
							</div>
							<div class="card-input">
								<span class="input-span" data-I18N="port">Port</span>
								<input class="form-control" id="port1" name="serial1-port" data-I18N="port" placeholder="Port">
							</div>
						</div>
					</div>
					<!-- SERIAL 1 -->
				</div>
				
				<div class="tab-pane fade" id="nav-serial2" role="tabpanel" aria-labelledby="serial2-tab">
					<!-- SERIAL 2 -->
					<div class="card card-serial">
						<div class="card-header">
							<h4 data-I18N="basic">Basic Settings</h4>
						</div>
						<div class="card-body">
							<div class="card-input">
								<span class="input-span" data-I18N="baud">Baud Rate</span>
								<select class="form-control" id="options-serial2-baudrate" name="serial2-baudrate">
									<option value="1200">1200</option>
									<option value="2400">2400</option>
									<option value="4800">4800</option>
									<option value="9600">9600</option>
									<option value="19200">19200</option>
									<option value="38400">38400</option>
									<option value="57600">57600</option>
									<option value="115200" selected>115200</option>
									<option value="250000">250000</option>
									<option value="921600">921600</option>
								</select>
							</div>
							<div class="card-input">
								<span class="input-span" data-I18N="databit">Data Bit</span>
								<select class="form-control" id="options-serial2-databit" name="serial2-databit">
									<option value="5">5</option>
									<option value="6">6</option>
									<option value="7">7</option>
									<option value="8" selected>8</option>
								</select>
							</div>
							<div class="card-input">
								<span class="input-span" data-I18N="stopbit">Stop Bit</span>
								<select class="form-control" id="options-serial2-stopbit" name="serial2-stopbit">
									<option value="1" selected>1</option>
									<option value="2">2</option>
								</select>
							</div>
							<div class="card-input">
								<span class="input-span" data-I18N="parity">Parity</span>
								<select class="form-control" id="options-serial2-parity" name="serial2-parity">
									<option value="1" selected data-I18N="none">None</option>
									<option value="2" data-I18N="even">Even</option>
									<option value="3" data-I18N="odd">Odd</option>
								</select>
							</div>
							<div class="card-input">
								<span class="input-span" data-I18N="port">Port</span>
								<input class="form-control" id="port2" name="serial2-port" data-I18N="port" placeholder="Port">
							</div>
						</div>
					</div>
					<!-- SERIAL 2 -->
				</div>
			</div>
		
			<div class="div-btn-save">
				<button class="btn btn-primary btn-save" id="btn-save-serial" type="submit" 
				data-I18N="save" onclick="spinner_by('spinner', 'btn-save-serial', 1)">
					Save
				</button>
				<div class="spinner-border text-primary hidden" id="spinner" role="status"></div>
			</div>
			
		</form>
	</div>
	
	<script src="bootstrap.min.js" defer></script>
	
</body>

<script src="scripts.js"></script>
<script>

	async function loadData(error) {
		const response = await fetch(error ? '/get-data-error' : '/get-data-serial');
		const data = await response.json();

		const fieldMap = {
			"baudrate1": "options-serial1-baudrate", "databit1": "options-serial1-databit",
			"stopbit1": "options-serial1-stopbit", "parity1": "options-serial1-parity",
			"baudrate2": "options-serial2-baudrate", "databit2": "options-serial2-databit",
			"stopbit2": "options-serial2-stopbit", "parity2": "options-serial2-parity",
			"port1": "port1", "port2": "port2"
		};

		for (const [key, elementId] of Object.entries(fieldMap)) {
			const element = document.getElementById(elementId);
			if (element) {
				element.value = data[key] || "";
			}
		}
	}

	document.addEventListener("DOMContentLoaded", () => {

		let url = new URL(window.location.href);
		let param = url.searchParams.get("error");
		let param2 = url.searchParams.get("success");

		var error = param !== null;
		var success = param2 !== null;

		var div = document.getElementById("div-error");
		var text = document.getElementById(param);
		if (error) {
			div.classList.remove("hidden");
			text.classList.remove("hidden");
		}

		loadExternal();
		loadData(error);	

		var div = document.getElementById("div-success");
		if (success) {
			if (param2 == "true") {
				div.classList.remove("hidden");
			}
		}
		else {
			div.classList.add("hidden");
		}

	});

</script>

</html>