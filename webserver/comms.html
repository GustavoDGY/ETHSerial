<!DOCTYPE html>
<html lang="pt-br">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" href="media/favicon.ico" sizes="any" type="image/x-icon">
	<link rel="stylesheet" href="comms.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" integrity="sha512-jnSuA4Ss2PkkikSOLtYs8BlYIeeIK1h99ty4YfvRPAlzr377vr3CXDb7sb7eEEBYjDtcYj+AjBH3FLv5uSJuXg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" media="print" onload="this.media='all'" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="util.css">
	<title>SerialETH - Communication Settings</title>
</head>

<header>
	<iframe class="top-iframe" id="top-iframe" src="top-bar.html"></iframe>
	<iframe class="side-iframe" src="side-bar.html"></iframe>
</header>

<body> 
	
	<div class="div-main">
	
		<div class="alert alert-warning hidden" id="div-error" role="alert">
			<p id="error-comms"></p>
		</div>
		
		<div class="alert alert-success hidden" id="div-success" role="alert">
			<p id="success-comms">
				The data has been stored successfully. </br>
				The board needs to restart for the configurations to take place. </br>
				You can click <a href="/restart">HERE</a> to restart now or restart manually later.
			</p>
		</div>
	
		<div class="page-title">
			<h5> Communication Settings </h3>
		</div>
	
		<form method="POST" id="form-post">
		
			<div class="card card-comms">
				<div class="card-header">
					<h4>Basic Settings</h4>
				</div>
				<div class="card-body">
					<div class="card-input">
						<span class="input-span">Name</span>
						<input class="form-control" type="text" name="name" id="name" placeholder="Name">
					</div>
					<div class="card-input">
						<span class="input-span">Protocol</span>
						<select class="form-control" id="options-protocol" name="protocol">
							<option value="1">TCP Server</option>
							<option value="2">UDP Server</option>
						</select>
					</div>
				</div>
			</div>
			
			<div class="card card-comms">
				<div class="card-header">
					<h4>Socket Settings</h4>
				</div>
				<div class="card-body">
					<div class="card-input">
						<span class="input-span">Local Port</span>
						<input class="form-control" type="text" name="port" id="port" placeholder="Local Port">
					</div>
					<div class="card-input">
						<span class="input-span">Buffer Size</span>
						<input class="form-control" type="text" name="buffer" id="buffer" placeholder="Buffer Size">
					</div>
					<div class="card-input">
						<span class="input-span">Keep Alive(s)</span>
						<input class="form-control" type="text" name="alive" id="alive" placeholder="Keep Alive">
					</div>
					<div class="card-input">
						<span class="input-span">Timeout(s)</span>
						<input class="form-control" type="text" name="timeout" id="timeout" placeholder="Timeout">
					</div>
				</div>
			</div>
			
			<div class="card card-comms">
				<div class="card-header">
					<h4>Protocol Settings</h4>
				</div>
				<div class="card-body">
					<div class="card-input">
						<span class="input-span">Max Accept</span>
						<input class="form-control" type="text" name="accept" id="accept" placeholder="Max Accept">
					</div>
				</div>
			</div>
			
			<div class="card card-comms">
				<div class="card-header">
					<h4>More Settings</h4>
				</div>
				<div class="card-body">
					<div class="card-input">
						<span class="input-span">Security</span>
						<select class="form-control" id="options-security" name="security">
							<option value="1">Disable</option>
							<option value="2">PLACEHOLDER</option>
						</select>
					</div>
					<div class="card-input">
						<span class="input-span">Route</span>
						<select class="form-control" id="options-route" name="route">
							<option value="1">Uart</option>
							<option value="2">PLACEHOLDER</option>
						</select>
					</div>
				</div>
			</div>
		
			
			<div class="div-btn-save">
				<button class="btn btn-primary btn-save" id="btn-save-comms" type="submit">Save</button>
			</div>
			
		</form>
	</div>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.min.js" integrity="sha512-ykZ1QQr0Jy/4ZkvKuqWn4iF3lqPZyij9iRv6sGqLRdTPkY69YX6+7wvVGmsdBbiIfN/8OdsI7HABjvEok6ZopQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	
</body>

<script>
	
	async function loadData(error) {
		
		const response = await fetch(error ? '/get-data-error' : '/get-data-comms');
		const data = await response.json();
		
		document.getElementById("name").value = data.comm_name;
		document.getElementById("options-protocol").value = data.protocol;
		document.getElementById("port").value = data.port;
		document.getElementById("buffer").value = data.buffer;
		document.getElementById("alive").value = data.keep_alive;
		document.getElementById("timeout").value = data.timeout;
		document.getElementById("accept").value = data.accept;
		document.getElementById("options-security").value = data.security;
		document.getElementById("options-route").value = data.route;
    }
	
	let url = new URL(window.location.href);
	let param = url.searchParams.get("error");
	let param2 = url.searchParams.get("success");
	
	var div = document.getElementById("div-error");
	var text = document.getElementById("error-comms");
	
	var error = param !== null
	var success = param2 !== null;
	
	loadData(error);
	
	var div = document.getElementById("div-success");
	if (success) {
		if (param2 == "true") {
			div.classList.remove("hidden");
		}
	}
	else {
		div.classList.add("hidden");
	}

</script>

</html>